<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../">
  <title data-ice="title">src/client.js | API Document</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  
  
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
</header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_check.js~CheckAnonymousRequest.html">CheckAnonymousRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_check.js~CheckEmailRequest.html">CheckEmailRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_check.js~CheckFacebookRequest.html">CheckFacebookRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_check.js~CheckGoogleRequest.html">CheckGoogleRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_check.js~CheckRequest.html">CheckRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_check.js~CheckTangoRequest.html">CheckTangoRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_link.js~LinkAnonymousRequest.html">LinkAnonymousRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_link.js~LinkFacebookRequest.html">LinkFacebookRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_link.js~LinkGoogleRequest.html">LinkGoogleRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_link.js~LinkRequest.html">LinkRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_link.js~LinkTangoRequest.html">LinkTangoRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_login.js~CreateEmailRequest.html">CreateEmailRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_login.js~EmailPasswordResetRequest.html">EmailPasswordResetRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_login.js~LoginAnonymousRequest.html">LoginAnonymousRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_login.js~LoginEmailRequest.html">LoginEmailRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_login.js~LoginFacebookRequest.html">LoginFacebookRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_login.js~LoginGoogleRequest.html">LoginGoogleRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_login.js~LoginRequest.html">LoginRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_login.js~LoginTangoRequest.html">LoginTangoRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_unlink.js~UnlinkAnonymousRequest.html">UnlinkAnonymousRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_unlink.js~UnlinkEmailRequest.html">UnlinkEmailRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_unlink.js~UnlinkFacebookRequest.html">UnlinkFacebookRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_unlink.js~UnlinkGoogleRequest.html">UnlinkGoogleRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_unlink.js~UnlinkRequest.html">UnlinkRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/account_unlink.js~UnlinkTangoRequest.html">UnlinkTangoRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/achievement.js~AchievementListRequest.html">AchievementListRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/achievement.js~AchievementUpdateRequest.html">AchievementUpdateRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client.js~Client.html">Client</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client.js~Response.html">Response</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/game.js~GameGetRequest.html">GameGetRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/gamer.js~GamerGetRequest.html">GamerGetRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/gamer.js~GamerUpdateRequest.html">GamerUpdateRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/leaderboard.js~LeaderboardAndRankGetRequest.html">LeaderboardAndRankGetRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/leaderboard.js~LeaderboardGetRequest.html">LeaderboardGetRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/leaderboard.js~LeaderboardListRequest.html">LeaderboardListRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/leaderboard.js~LeaderboardUpdateRequest.html">LeaderboardUpdateRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/match.js~MatchCreateRequest.html">MatchCreateRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/match.js~MatchGetRequest.html">MatchGetRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/match.js~MatchListRequest.html">MatchListRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/match.js~MatchMakeRequest.html">MatchMakeRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/match.js~MatchTurnEndRequest.html">MatchTurnEndRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/match.js~MatchTurnGetRequest.html">MatchTurnGetRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/match.js~MatchTurnLeaveRequest.html">MatchTurnLeaveRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/match.js~MatchTurnSubmitRequest.html">MatchTurnSubmitRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/match.js~MatchesSinceRequest.html">MatchesSinceRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/message.js~MessageDeleteRequest.html">MessageDeleteRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/message.js~MessageListRequest.html">MessageListRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/message.js~MessageReadRequest.html">MessageReadRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/ping.js~PingRequest.html">PingRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/request.js~AccountsRequest.html">AccountsRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/request.js~ApiRequest.html">ApiRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/request.js~Request.html">Request</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/script.js~ExecuteScriptRequest.html">ExecuteScriptRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/server.js~ServerRequest.html">ServerRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/session.js~Session.html">Session</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/shared_storage.js~SharedStorageDeleteRequest.html">SharedStorageDeleteRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/shared_storage.js~SharedStorageGetRequest.html">SharedStorageGetRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/shared_storage.js~SharedStoragePatchRequest.html">SharedStoragePatchRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/shared_storage.js~SharedStoragePutRequest.html">SharedStoragePutRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/shared_storage.js~SharedStorageSearchRequest.html">SharedStorageSearchRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/storage.js~StorageDeleteRequest.html">StorageDeleteRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/storage.js~StorageGetRequest.html">StorageGetRequest</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/storage.js~StoragePutRequest.html">StoragePutRequest</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/client.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">/*
 * Copyright 2016 Heroic Labs
 *
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 * [HEROICLABS_API API server URL.]
 * @type {String}
 */
const HEROICLABS_API = &apos;api.heroiclabs.com&apos;;

/**
 * [HEROICLABS_ACCOUNTS Accounts server URL.]
 * @type {String}
 */
const HEROICLABS_ACCOUNTS = &apos;accounts.heroiclabs.com&apos;;

/**
 * Client responsible for making requests to the Heroic Labs service.
 */
export class Client {

  /**
   * @param  {String} apikey API key used in all requests made by this client.
   * @return {Client} An instance of this object.
   */
  constructor(apikey) {
    this._apikey = apikey;
    this._apiUrl = HEROICLABS_API;
    this._accountsUrl = HEROICLABS_ACCOUNTS;
  }

  setApiServer(apiUrl) {
    this._apiUrl = apiUrl;
    return this;
  }

  setAccountsServer(accountsUrl) {
    this._accountsUrl = accountsUrl;
    return this;
  }

  /**
   * Execute a given request.
   * @param  {Request} request The request to execute.
   * @return {Promise} A deferred promise object which will resolve into a Response object.
   */
  execute(request) {
    return new Promise((resolve, reject) =&gt; {
      var xhr = new XMLHttpRequest();
      var uri;
      var gamerToken = &apos;&apos;;

      uri = this._apiUrl + request._url;
      if (request._type === &apos;accounts&apos;) {
        uri = this._accountsUrl + request._url;
      }
      uri = &apos;https://&apos; + uri;

      if (request._session != null) {
        gamerToken = request._session._token;
      }

      if (request._queryParams) {
        uri += &apos;?&apos;;
        let counter = 0;
        let keys = Object.keys(request._queryParams);
        for (let key of keys) {
          uri += encodeURIComponent(key) + &apos;=&apos; + encodeURIComponent(String(request._queryParams[key]));
          counter++;
          if (counter &lt; keys.length) {
            uri += &apos;&amp;&apos;;
          }
        }
      }

      xhr.timeout = 5000;
      xhr.onreadystatechange = () =&gt; {
        xhr.onload = () =&gt; {
          let response = null;
          if (xhr.status &gt;= 200 &amp;&amp; xhr.status &lt; 300) {
            if (request._responseCallback != null) {
              response = new Response(xhr, request, request._responseCallback(xhr));
            } else {
              response = new Response(xhr, request);
            }
            Object.freeze(response);
            resolve(response);
          } else {
            response = new Response(xhr, request);
            Object.freeze(response);
            reject(response);
          }
        };
        xhr.onerror = function () {
          let response = new Response(xhr, request);
          Object.freeze(response);
          reject(response);
        };
        xhr.ontimeout = function () {
          let response = new Response(xhr, request);
          Object.freeze(response);
          reject(response);
        };
      };

      xhr.open(request._method, uri, true);

      xhr.setRequestHeader(&apos;Authorization&apos;, &apos;Basic &apos; + btoa(this._apikey + &apos;:&apos; + gamerToken));
      xhr.setRequestHeader(&apos;Content-Type&apos;, &apos;application/json; charset=utf-8&apos;);
      xhr.setRequestHeader(&apos;Accept&apos;, &apos;application/json&apos;);
      // xhr.setRequestHeader(&apos;User-Agent&apos;, &apos;&apos;);

      xhr.send(JSON.stringify(request._body));
    });
  }
}

/**
 * Response from the Heroic Labs service.
 */
export class Response {
  constructor(jsXHR, request, body) {
    /**
     * [xhr Original XHR]
     * @type {XMLHttpRequest}
     */
    this.xhr = jsXHR;

    /**
     * [request Original sent request.]
     * @type {Request}
     */
    this.request = request;

    /**
     * [status HTTP Status]
     * @type {Integer}
     */
    this.status = jsXHR.status;

    /**
     * [message HTTP Status Message]
     * @type {String}
     */
    this.message = jsXHR.statusText;

    /**
     * [body Body of the Response. Could be different to the XHR Body.]
     * @type {Object}
     */
    this.body = null;

    if (body != null) {
      this.body = body;
    } else if (jsXHR.responseText !== null &amp;&amp; jsXHR.responseText.length &gt; 0) {
      this.body = JSON.parse(jsXHR.responseText);
    }
  }
}
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(0.4.5)</span></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
